var S=Object.defineProperty;var T=(a,n,t)=>n in a?S(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t;var r=(a,n,t)=>(T(a,typeof n!="symbol"?n+"":n,t),t);import{H as f,S as y,C,a as $,B as h,b as i}from"./index-O9cDETt7.js";import{B as l,s as F,p as _,d as g,H as x,m as N,h as V}from"./HeaderView-CGELgH2Q.js";const j="_page_1kq1f_1",R="_main_1kq1f_1",q="_carForm_1kq1f_13",D="_buttons_1kq1f_19",U="_carQuantity_1kq1f_24",Q="_pageInfo_1kq1f_32",m={page:j,main:R,carForm:q,buttons:D,carQuantity:U,pageInfo:Q},p=7;async function E(a,n){try{let t="http://localhost:3000/garage/";if(arguments.length){t+="?";const s=[];a&&s.push(`_page=${a}`),n&&s.push(`_limit=${n}`),t+=s.join("&")}return await(await fetch(t)).json()}catch{return console.error("An error occured"),null}}async function k(a){try{const n=await fetch("http://localhost:3000/garage",{method:f.POST,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),{status:t}=n;return t===y.Created?await n.json():null}catch(n){return console.error(`An error occured ${n}`),null}}async function A(a){try{await fetch(`http://localhost:3000/garage/${a}`,{method:f.DELETE})}catch(n){console.error(`An error occured ${n}`)}}async function H(a){try{const{id:n,name:t,color:e}=a,s=await fetch(`http://localhost:3000/garage/${n}`,{method:f.PUT,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,color:e})}),{status:o}=s;return o===y.OK?await s.json():null}catch(n){return console.error(`An error occured ${n}`),null}}async function L(a,n){try{const t=await fetch(`http://localhost:3000/engine?id=${a}&status=${n}`,{method:f.PATCH}),{status:e}=t;if(e===C.BadRequest)console.error('Wrong parameters: "id" should be any positive number, "status" should be "started", "stopped" or "drive"');else if(e===C.NotFound)console.error("Car with such id was not found in the garage.");else if(e===y.OK)return await t.json();return null}catch(t){return console.error(`An error occured ${t}`),null}}async function M(a){try{const n=await fetch(`http://localhost:3000/engine?id=${a}&status=drive`,{method:f.PATCH}),{status:t}=n;if(t===C.BadRequest)console.error('Wrong parameters: "id" should be any positive number, "status" should be "started", "stopped" or "drive"');else if(t===C.NotFound)console.error('Engine parameters for car with such id was not found in the garage. Have you tried to set engine status to "started" before?');else if(t===C.TooManyRequests)console.error("Drive already in progress. You can't run drive for the same car twice while it's not stopped.");else{if(t===$.InternalError)return console.error("Car has been stopped suddenly. It's engine was broken down."),{success:!1};if(t===y.OK)return await n.json()}return null}catch(n){return console.error(`An error occured ${n}`),null}}const O=10,X="_input_1dh2a_1",W={input:X};class I extends h{constructor(t,e,s,o,u,c){super({tagName:"input",className:W.input,type:t,name:e,required:s,disabled:o,minLength:u,pattern:c});r(this,"type");this.type=t}getInputType(){return this.type}getInputValue(){return this.element.value}setInputValue(t){this.element.value=t}focus(){this.element.focus()}setParameters(t){super.setParameters(t);const{type:e,name:s,required:o,disabled:u,minLength:c,pattern:b}=t;e&&(this.element.type=e),s&&(this.element.name=s),o&&(this.element.required=o),u&&(this.element.disabled=u),c&&(this.element.minLength=c),b&&(this.element.pattern=b)}}const K="_form_ocdoo_1",z="_button_ocdoo_6",B={form:K,button:z};class P extends h{constructor(t,e,s){const o=[new I("text","Car name",!0,e,2),new I("color","",!0,e)];super({tagName:"form",className:B.form},...o,new l(`${B.button} ${s}`,"submit",t,void 0,e));r(this,"inputs");this.inputs=o,this.initListeners()}resetInputs(){this.children.forEach(t=>{const e=t.getElement();e instanceof HTMLInputElement&&(e.value="")})}disableForm(){this.children.forEach(t=>{const e=t.getElement();(e instanceof HTMLInputElement||e instanceof HTMLButtonElement)&&(e.disabled=!0),e instanceof HTMLInputElement&&(e.value="")})}enableForm(){this.children.forEach(t=>{const e=t.getElement();(e instanceof HTMLInputElement||e instanceof HTMLButtonElement)&&(e.disabled=!1)})}getCarObjectFromInputs(){return this.inputs.reduce((e,s)=>(s.getInputType()==="color"&&(e.color=s.getInputValue()),s.getInputType()==="text"&&(e.name=s.getInputValue()),e),{})}initListeners(){this.element.onsubmit=()=>!1}}class J extends P{constructor(){super("Create a car")}initListeners(){super.initListeners(),this.element.addEventListener("submit",async()=>{const n=this.getCarObjectFromInputs(),t=await E();let e=1;t&&(e=t[t.length-1].id+1),n.id=e,this.element.dispatchEvent(new CustomEvent(i.CreateCar,{bubbles:!0,detail:{car:n}}))})}}const G="_updateButton_1drd0_1",Y={updateButton:G};class Z extends P{constructor(){super("Update a car",!0,Y.updateButton);r(this,"currentCarId")}setCurrentCarId(t){this.currentCarId=t}deleteCurrentCarId(){delete this.currentCarId}initListeners(){super.initListeners(),this.element.addEventListener("submit",async()=>{const t=this.getCarObjectFromInputs();t.id=this.currentCarId,this.element.dispatchEvent(new CustomEvent(i.UpdateCar,{bubbles:!0,detail:{car:t}}))})}}function tt(a){const n=window.getComputedStyle(a);return new WebKitCSSMatrix(n.transform).m41}class et extends h{constructor(n,t="",e){super({tagName:"img",className:e,src:n,alt:t})}setParameters(n){super.setParameters(n);const{alt:t,src:e}=n;e&&(this.element.src=e),t?this.element.alt=t:this.element.alt=""}}const nt="_info_8y0mj_1",st="_buttons_8y0mj_9",at="_svg_8y0mj_14",rt="_carName_8y0mj_24",it="_road_8y0mj_31",ot="_finish_8y0mj_43",d={info:nt,buttons:st,svg:at,carName:rt,road:it,finish:ot};class ct extends l{constructor(){super("","button","Delete"),this.initListeners()}initListeners(){this.element.addEventListener("click",()=>{this.element.dispatchEvent(new CustomEvent(i.TriggerDeleteCar,{bubbles:!0}))})}}class ut extends l{constructor(){super("","button","Select"),this.initListeners()}initListeners(){this.element.addEventListener("click",()=>{this.element.dispatchEvent(new CustomEvent(i.TriggerUpdateCarInfo,{bubbles:!0}))})}}const lt="_button_1o4jr_1",dt="_primary_1o4jr_18",ht="_secondary_1o4jr_35",mt={button:lt,primary:dt,secondary:ht};class pt extends l{constructor(){super(mt.button,"button","Start"),this.initListeners()}initListeners(){this.element.addEventListener("click",()=>{this.element.dispatchEvent(new CustomEvent(i.StartCar,{bubbles:!0}))})}}const Ct="_button_49jio_1",gt="_primary_49jio_18",ft="_secondary_49jio_35",bt={button:Ct,primary:gt,secondary:ft};class vt extends l{constructor(){super(bt.button,"button","Stop",void 0,!0),this.initListeners()}initListeners(){this.element.addEventListener("click",()=>{this.element.dispatchEvent(new CustomEvent(i.StopCar,{bubbles:!0}))})}}const yt=""+new URL("car-JMzejMHG.svg",import.meta.url).href,wt=""+new URL("finish-C1N534Yl.webp",import.meta.url).href;class _t extends h{constructor(t){const{id:e,name:s,color:o}=t,u=F(`<svg width="100%" height="auto" 
      viewBox="0 0 100 45"><use href="./${yt}#car"></use></svg>
      `,d.svg),c=_(s||"No Name",d.carName);super({tagName:"div",className:d.info},c,g(d.buttons,new ut,new ct));r(this,"id");r(this,"carSvgComp");r(this,"nameComp");r(this,"color");r(this,"name");r(this,"translateXShift",0);r(this,"animationRequestID");r(this,"startButton");r(this,"stopButton");this.startButton=new pt,this.stopButton=new vt,this.addChildrenComponents("end",g(d.buttons,this.startButton,this.stopButton),u,g(d.road),new et(wt,"finish",d.finish)),this.id=e,this.color=o,this.name=s,this.carSvgComp=u,this.nameComp=c,this.setCarColor(o),this.initListeners()}setCarColor(t){this.carSvgComp.getElement().style.fill=t,this.color=t}setCarName(t){this.nameComp.setTextContent(t),this.name=t}getCarInfo(){return{id:this.id,color:this.color,name:this.name}}setCarInfo(t){const{color:e,name:s}=t;this.setCarColor(e),this.setCarName(s)}async startCar(){const t=await L(this.id,"started");if(t){console.log(`car ${[t.distance,t.velocity]} started successfully`),this.startButton.disable(),this.stopButton.enable(),this.translateXShift=this.getElementWidth()*t.velocity/t.distance*O,this.animationRequestID=requestAnimationFrame(this.moveCar.bind(this));const e=await M(this.id);e&&!e.success&&cancelAnimationFrame(this.animationRequestID)}}async moveCar(){const t=tt(this.carSvgComp.getElement());this.carSvgComp.getElement().style.transform=`translateX(${t+this.translateXShift}px)`,!(t>=this.getElementWidth()-this.carSvgComp.getElementWidth())&&(this.animationRequestID=requestAnimationFrame(this.moveCar.bind(this)))}async stopCar(){this.stopButton.disable(),await L(this.id,"stopped"),this.animationRequestID&&cancelAnimationFrame(this.animationRequestID),this.carSvgComp.getElement().style.transform="translateX(0)",this.startButton.enable()}initListeners(){this.initTriggerUpdateCarInfoListener(),this.initTriggerDeleteCarListener(),this.initTriggerStartCarListener(),this.initTriggerStopCarListener()}initTriggerUpdateCarInfoListener(){this.element.addEventListener(i.TriggerUpdateCarInfo,()=>{this.element.dispatchEvent(new CustomEvent(i.FocusUpdateCarInput,{bubbles:!0,detail:{car:this.getCarInfo()}}))})}initTriggerDeleteCarListener(){this.element.addEventListener(i.TriggerDeleteCar,()=>{this.element.dispatchEvent(new CustomEvent(i.DeleteCar,{bubbles:!0,detail:{car:this.getCarInfo()}}))})}initTriggerStartCarListener(){this.element.addEventListener(i.StartCar,()=>{this.startCar()})}initTriggerStopCarListener(){this.element.addEventListener(i.StopCar,()=>{this.stopCar()})}}const Et="_list_ua2qy_1",Lt={list:Et};class It extends h{constructor(n){super({tagName:"div",className:Lt.list}),this.updateChildren(n,p)}async updateChildren(n,t){this.removeChildrenComponents();const e=await E(n,t),s=[];e&&e.forEach(o=>s.push(new _t(o))),this.addChildrenComponents("end",...s)}findChildComponentById(n){return this.children.find(e=>e.id===n)}}const Bt="_pagination_ellzc_1",Pt="_button_ellzc_7",w={pagination:Bt,button:Pt};class St extends h{constructor(){super({tagName:"div",className:w.pagination});r(this,"prevButton");r(this,"nextButton");this.prevButton=new l(w.button,"button","Prev",void 0,!0),this.nextButton=new l(w.button,"button","Next"),this.addChildrenComponents("end",this.prevButton,this.nextButton),this.initListeners()}initListeners(){this.nextButton.getElement().addEventListener("click",()=>{this.element.dispatchEvent(new CustomEvent(i.NextPage,{bubbles:!0}))}),this.prevButton.getElement().addEventListener("click",()=>{this.element.dispatchEvent(new CustomEvent(i.PrevPage,{bubbles:!0}))}),this.element.addEventListener(i.UpdatePaginationState,t=>{})}}const Tt="_button_1o4jr_1",$t="_primary_1o4jr_18",Ft="_secondary_1o4jr_35",xt={button:Tt,primary:$t,secondary:Ft};class Nt extends l{constructor(){super(xt.button,"button","Race"),this.initListeners()}initListeners(){this.element.addEventListener("click",()=>{this.element.dispatchEvent(new CustomEvent(i.StartRace,{bubbles:!0}))})}}const Vt="_button_49jio_1",jt="_primary_49jio_18",Rt="_secondary_49jio_35",qt={button:Vt,primary:jt,secondary:Rt};class Dt extends l{constructor(){super(qt.button,"button","Stop race",void 0,!0),this.initListeners()}initListeners(){this.element.addEventListener("click",()=>{this.element.dispatchEvent(new CustomEvent(i.StopRace,{bubbles:!0}))})}}class v extends h{constructor(){super({tagName:"div",className:"page"},new x);r(this,"carsList");r(this,"updateCarFormView");r(this,"raceButton");r(this,"stopRaceButton");r(this,"createCarFormView");r(this,"carQuantityComp");r(this,"currentPage",1);r(this,"pageInfoComp");r(this,"pagination");r(this,"totalPages");this.updateCarFormView=new Z,this.raceButton=new Nt,this.stopRaceButton=new Dt,this.createCarFormView=new J,this.carQuantityComp=_("",m.carQuantity),this.pageInfoComp=_("",m.pageInfo);const t=N(m.main,V("h1","Garage"),g(m.carForm,this.createCarFormView,this.updateCarFormView,g(m.buttons,this.raceButton,this.stopRaceButton)),this.carQuantityComp,this.pageInfoComp);this.carsList=new It(1),this.pagination=new St,t.addChildrenComponents("end",this.carsList,this.pagination),this.addChildrenComponents("end",t),this.updateCarQuantity(),this.updatePagesInfo(),this.initEventListeners()}async updatePagesInfo(){const t=await v.getPagesQuantity();this.totalPages=t,this.pageInfoComp.setTextContent(`Page #${this.currentPage} / ${t}`)}async updateCarQuantity(){const t=await v.getTotalCarsQuantity();this.carQuantityComp.setTextContent(`Total cars in the Garage: ${t}`)}static async getTotalCarsQuantity(){const t=await E();return t?t.length:0}static async getPagesQuantity(){const t=await v.getTotalCarsQuantity();return Math.ceil(t/p)}initEventListeners(){this.initCreateCarListener(),this.initFocusUpdateCarInputListener(),this.initUpdateCarListener(),this.initDeleteCarListener(),this.initNextPageListener(),this.initPrevPageListener()}initCreateCarListener(){this.element.addEventListener(i.CreateCar,async t=>{if(t instanceof CustomEvent){const{car:e}=t.detail,s=await k(e);console.log("new car",s),this.carsList.updateChildren(this.currentPage,p),this.createCarFormView.resetInputs(),this.updateCarQuantity(),this.updatePagesInfo()}})}initFocusUpdateCarInputListener(){this.element.addEventListener(i.FocusUpdateCarInput,t=>{if(t instanceof CustomEvent){const{detail:e}=t,{id:s,name:o,color:u}=e.car;this.updateCarFormView.enableForm(),this.updateCarFormView.setCurrentCarId(s);const[c,b]=this.updateCarFormView.inputs;c.focus(),c.setInputValue(o),b.setInputValue(u)}})}initUpdateCarListener(){this.element.addEventListener(i.UpdateCar,async t=>{if(t instanceof CustomEvent){const{car:e}=t.detail,s=await H(e);if(s){const o=this.carsList.findChildComponentById(e.id);o&&o.setCarInfo(s)}this.updateCarFormView.disableForm()}})}initDeleteCarListener(){this.element.addEventListener(i.DeleteCar,async t=>{if(t instanceof CustomEvent){const{car:e}=t.detail;await A(e.id),this.carsList.removeChildComponent(e.id)}this.updateCarQuantity(),this.updatePagesInfo()})}initNextPageListener(){this.element.addEventListener(i.NextPage,()=>{this.currentPage+=1,this.carsList.updateChildren(this.currentPage,p),this.pagination.getElement().dispatchEvent(new CustomEvent(i.UpdatePaginationState,{detail:{page:this.currentPage,totalPages:this.totalPages}}))})}initPrevPageListener(){this.element.addEventListener(i.PrevPage,()=>{this.currentPage-=1,this.carsList.updateChildren(this.currentPage,p)})}}export{v as default};
