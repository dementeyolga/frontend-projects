function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./ChatPageView-Baj8eUMg.js","./ChatPageView-kldbT2Xl.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var H=Object.defineProperty;var D=(e,t,s)=>t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var r=(e,t,s)=>(D(e,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();var k=(e=>(e.Login="",e.Chat="chat",e))(k||{}),C=(e=>(e.User="funChatAppAuthenticatedUser",e))(C||{}),u=(e=>(e.OpenSocket="openSocket",e.Login="login",e.CurrentUser="currentUser",e.ActiveUsers="activeUsers",e.InactiveUsers="inactiveUsers",e.ExternalLogin="externalLogin",e.ExternalLogout="externalLogout",e.MessageSent="messageSent",e.MessageReceived="messageReceived",e.MessageHistory="messageHistory",e))(u||{}),l=(e=>(e.UserLogin="USER_LOGIN",e.UserLogout="USER_LOGOUT",e.UserExternalLogin="USER_EXTERNAL_LOGIN",e.UserExternalLogout="USER_EXTERNAL_LOGOUT",e.UsersActive="USER_ACTIVE",e.UsersInactive="USER_INACTIVE",e.SendMessage="MSG_SEND",e.MessageHistory="MSG_FROM_USER",e.MessageDelivered="MSG_DELIVER",e.MessageRead="MSG_READ",e.DeleteMessage="MSG_DELETE",e.EditMessage="MSG_EDIT",e.Error="ERROR",e))(l||{}),S=(e=>(e.Input="input",e.Submit="submit",e.Click="click",e))(S||{}),b=(e=>(e.FormInput="form-input",e.TextAreaInput="textarea-input",e.OpenChat="open-chat",e.SendChatMessage="send-chat-message",e))(b||{}),m=(e=>(e.Open="open",e.Close="close",e.Message="message",e.Error="error",e))(m||{});function I(e){return e instanceof Object&&typeof e.login=="string"&&typeof e.isLogined=="boolean"}function R(e){return e instanceof Object&&typeof e.login=="string"&&typeof e.password=="string"}function Pe(e){return!!(Array.isArray(e)&&(e.length===0||e.every(I)))}function M(e){return!!(e.user&&I(e.user))}function F(e){return!!(e.user&&R(e.user))}function G(e){if(typeof e.id=="string"&&e.type===l.UserLogin&&e.payload){const{payload:t}=e;if(F(t))return!0}return!1}function j(e){if(typeof e.id=="string"&&e.type===l.UserLogin&&e.payload){const{payload:t}=e;if(M(t))return!0}return!1}function W(e){if(e.type===l.UserLogout&&e.payload){const{payload:t}=e;if(M(t))return!0}return!1}function A(e){return!!(e.users&&(!e.users.length||e.users.every(I)))}function z(e){if(e.type===l.UsersActive&&e.payload){const{payload:t}=e;if(A(t))return!0}return!1}function J(e){return!!(e.type===l.UsersInactive&&e.payload&&A(e.payload))}function X(e){return!!(e&&typeof e.error=="string")}function Z(e){return!!(e.type===l.Error&&e.payload&&X(e.payload))}function Q(e){return!!(e.type===l.UserExternalLogin&&M(e.payload))}function Y(e){return!!(e.type===l.UserExternalLogout&&M(e.payload))}function K(e){return e instanceof Object&&typeof e.text=="string"&&typeof e.to=="string"}function ee(e){return e instanceof Object&&typeof e.isDelivered=="boolean"&&typeof e.isEdited=="boolean"&&typeof e.isReaded=="boolean"}function q(e){return!!(K(e)&&typeof e.from=="string"&&typeof e.datetime=="number"&&typeof e.id=="string"&&ee(e.status))}function te(e){return!!(e instanceof Object&&e.message&&q(e.message))}function se(e){return!!(e.type===l.SendMessage&&te(e.payload))}function ne(e){return!!(Array.isArray(e)&&(e.length===0||e.every(q)))}function ie(e){const{messages:t}=e;return!!(e instanceof Object&&t&&ne(t))}function re(e){return!!(e instanceof Object&&ie(e.payload))}class d{constructor(t,...s){r(this,"children",[]);r(this,"element");r(this,"id");const n=document.createElement(t.tagName||"div");this.element=n,this.setParameters(t),s.length&&this.addChildrenComponents("end",...s)}getElement(){return this.element}getElementWidth(){return this.element.offsetWidth}setTextContent(t){this.element.textContent=t}getTextContent(){return this.element.textContent}setParameters(t){const{textContent:s,className:n,id:i,innerHTML:o}=t;s&&(this.element.textContent=s),n&&this.setClassName(n),i&&(this.element.id=i),o&&(this.element.innerHTML=o)}addChildrenComponents(t,...s){s.forEach(async n=>{this.addChild(n.getElement(),t),t==="end"?this.children.push(n):this.children.unshift(n)})}removeChildrenComponents(){this.children.length=0;const t=this.getElement();t.innerHTML=""}removeChildComponent(t){let s;if(t instanceof d?s=t:typeof t=="number"?s=this.findChildComponentById(t):t instanceof HTMLElement?s=this.findChildComponentByElement(t):typeof t=="string"&&(s=this.findChildComponentByTextContent(t)),s){const n=this.children.indexOf(s);this.children.splice(n,1),s.destroy()}}destroy(){this.element.remove()}findChildComponentByElement(t){return this.children.find(n=>n.getElement()===t)}findChildComponentById(t){return this.children.find(n=>n.id?n.id===t:!1)}findChildComponentByTextContent(t){return this.children.find(n=>n.getTextContent()?n.getTextContent()===t:!1)}setClassName(t){this.element.className=t}addClass(t){this.element.classList.add(t)}removeClass(t){this.element.classList.remove(t)}addChild(t,s){s==="begin"?this.element.prepend(t):this.element.append(t)}}const oe="_form_m8e8v_1",ae={form:oe},Oe=(e,...t)=>new d({tagName:"div",className:e},...t),xe=(e,...t)=>new d({tagName:"main",className:e},...t),le=(e,t)=>new d({tagName:"p",className:t,textContent:e}),ue="_label_xewfv_1",ce="_errorMsg_xewfv_8",P={label:ue,errorMsg:ce};class O extends d{constructor(s,n){super({className:P.label,tagName:"label",textContent:s},n);r(this,"errorMsg");r(this,"inputComp");this.inputComp=n,this.errorMsg=le("",P.errorMsg),this.addChildrenComponents("end",this.errorMsg),this.initListeners()}setParameters(s){super.setParameters(s);const{htmlFor:n}=s;n&&(this.element.htmlFor=n)}initListeners(){this.element.addEventListener(b.FormInput,()=>{this.inputComp.checkValid()?this.errorMsg.setTextContent(""):this.inputComp.checkTooShort()?this.errorMsg.setTextContent(`${this.inputComp.getName()[0].toUpperCase()+this.inputComp.getName().slice(1)||"Value"} must contain at least ${this.inputComp.getMinLength()} characters, you typed ${this.inputComp.getValue().length}.`):this.inputComp.checkPatternMismatch()&&this.errorMsg.setTextContent(this.inputComp.patternMessage)})}}const de="_input_1dh2a_1",he={input:de};class x extends d{constructor(s,n){const{type:i}=s;super({tagName:"input",className:he.input,...s});r(this,"type");r(this,"patternMessage");this.type=i,this.patternMessage=n||`${this.getName()||"Value"} doesn't match the pattern: ${s.pattern}`,this.initListeners()}getType(){return this.type}getValue(){return this.element.value}setValue(s){this.element.value=s}getName(){return this.element.name}getMinLength(){return this.element.minLength}focus(){this.element.focus()}checkTooShort(){return this.element.validity.tooShort}checkPatternMismatch(){return this.element.validity.patternMismatch}checkValid(){return this.element.validity.valid}setParameters(s){super.setParameters(s);const{type:n,name:i,required:o,disabled:a,minLength:p,pattern:c}=s;n&&(this.element.type=n),i&&(this.element.name=i),o&&(this.element.required=o),a&&(this.element.disabled=a),p&&(this.element.minLength=p),c&&(this.element.pattern=c)}initListeners(){this.element.addEventListener(S.Input,()=>{this.element.dispatchEvent(new CustomEvent(b.FormInput,{bubbles:!0,detail:this.getValue()}))})}}const pe="_button_109p7_1",fe="_primary_109p7_18",ge="_secondary_109p7_35",me={button:pe,primary:fe,secondary:ge};class ye extends d{constructor(t,s){super({tagName:"button",className:me.button,...t}),s&&(this.element.dataset.navigate=s)}setParameters(t){super.setParameters(t);const{type:s,disabled:n}=t;s&&(this.element.type=s),n&&(this.element.disabled=n)}disable(){this.element.disabled=!0}enable(){this.element.disabled=!1}}const w=class w{constructor(){r(this,"observedValues",new Map);r(this,"notifyCallbacks",new Map)}static getInstance(){return this.instance}getValue(t){return this.observedValues.has(t)?this.observedValues.get(t):null}setValue(t,s){this.observedValues.set(t,s),this.notify(t,s)}triggerEvent(t){console.log(`event ${t} triggered`),this.notify(t)}subscribe(t,s){console.log(`SUBSCIBED TO EVENT ${t}`);let n=this.notifyCallbacks.get(t);n||(n=new Set,this.notifyCallbacks.set(t,n)),n.add(s)}unsubscribe(t,s){const n=this.notifyCallbacks.get(t);n&&n.delete(s)}notify(t,s){const n=this.notifyCallbacks.get(t);console.log(`notifying about ${t} event`,n),n&&n.forEach(i=>i(s))}};r(w,"instance",new w);let y=w;const E=class E{constructor(t){r(this,"socket");r(this,"state",y.getInstance());r(this,"requests",[]);this.url=t,this.socket=new WebSocket(`ws://${t}`),this.initSocketListeners()}static getInstance(){return this.instance}openSocketConnection(t){this.socket=new WebSocket(`ws://${t}`),this.initSocketListeners()}initSocketListeners(){this.initOpenListener()}initOpenListener(){this.socket.addEventListener(m.Open,()=>{console.log("socket has opened"),this.initMessageListener(),this.initErrorListener(),this.initCloseListener(),this.state.setValue(u.OpenSocket,"open")})}initCloseListener(){this.socket.addEventListener(m.Close,()=>{console.log("socket has closed"),this.openSocketConnection(this.url),this.initOpenListener()})}initErrorListener(){this.socket.addEventListener(m.Error,t=>{console.log("WebSocket error: ",t)})}initMessageListener(){this.socket.addEventListener(m.Message,t=>{const s=JSON.parse(t.data);if(j(s)){console.log("user logined: ",s);const n=this.requests.find(i=>i.id===s.id&&i.type===l.UserLogin);if(n&&G(n)){console.log("relevant login request: ",n);const{user:i}=n.payload;sessionStorage.setItem(C.User,JSON.stringify(i)),this.state.setValue(u.CurrentUser,i)}}W(s)&&(sessionStorage.removeItem(C.User),this.state.setValue(u.CurrentUser,null)),z(s)&&(console.log("active users response",s),this.state.setValue(u.ActiveUsers,s.payload.users)),J(s)&&(console.log("inactive users response",s),this.state.setValue(u.InactiveUsers,s.payload.users)),Z(s)&&console.log("error",s.payload),Q(s)&&(console.log("user logged in",s.payload.user),this.state.setValue(u.ExternalLogin,s.payload.user.login)),Y(s)&&(console.log("user logged out",s.payload.user),this.state.setValue(u.ExternalLogout,s.payload.user.login)),se(s)&&(s.id===null?(console.log("message received",s),this.state.setValue(u.MessageReceived,s.payload.message)):(console.log("message successfully sent",s),this.state.setValue(u.MessageSent,s.payload.message))),re(s)&&(console.log("message history received",s),this.state.setValue(u.MessageHistory,s.payload.messages))})}send(t){const s=JSON.stringify(t);this.socket.send(s)}sendLoginRequest(t,s){const n={id:String(this.requests.length+1),type:l.UserLogin,payload:{user:{login:t,password:s}}};this.requests.push(n),this.send(n)}sendLogoutRequest(t,s){const n={id:String(this.requests.length+1),type:l.UserLogout,payload:{user:{login:t,password:s}}};this.requests.push(n),this.send(n)}sendActiveUsersRequest(){const t={id:String(this.requests.length+1),type:l.UsersActive,payload:null};this.requests.push(t),this.send(t)}sendInActiveUsersRequest(){const t={id:String(this.requests.length+1),type:l.UsersInactive,payload:null};this.requests.push(t),this.send(t)}sendChatMessage(t,s){const n={id:String(this.requests.length+1),type:l.SendMessage,payload:{message:{to:t,text:s}}};this.requests.push(n),this.send(n)}sendMessageHistoryRequest(t){const s={id:String(this.requests.length+1),type:l.MessageHistory,payload:{user:{login:t}}};this.requests.push(s),this.send(s)}};r(E,"instance",new E("127.0.0.1:4000"));let v=E;class Le extends d{constructor(){super({tagName:"form",className:ae.form,novalidate:!0});r(this,"loginInput");r(this,"passwordInput");r(this,"loginButton");r(this,"socket",v.getInstance());this.loginInput=new x({type:"text",name:"login",required:!0,pattern:"[a-z\\-_]{3,}",minLength:3},"Login must start with uppercase letter and contain only English letters or '-'"),this.passwordInput=new x({type:"password",name:"password",required:!0,pattern:"^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$",minLength:8},"Password should be minimum 8 characters and contain at least 1 uppercase letter and 1 lowercase letter"),this.loginButton=new ye({type:"submit",textContent:"Log in",disabled:!0}),this.addChildrenComponents("end",new O("Login",this.loginInput),new O("Password",this.passwordInput),this.loginButton),this.initListeners()}setParameters(s){super.setParameters(s);const{novalidate:n}=s;n&&(this.element.noValidate=n)}initListeners(){this.initSubmitListener(),this.initFormInputListener()}initSubmitListener(){this.element.addEventListener(S.Submit,s=>{s.preventDefault();const n=this.loginInput.getValue(),i=this.passwordInput.getValue();this.socket.sendLoginRequest(n,i)})}initFormInputListener(){this.element.addEventListener(b.FormInput,()=>{this.element.checkValidity()?this.loginButton.getElement().disabled=!1:this.loginButton.getElement().disabled=!0})}}const Ce="_page_44laf_1",ve={page:Ce};class U extends d{constructor(){super({tagName:"div",className:ve.page},new Le)}}const T=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));class we{constructor(t){r(this,"socket",v.getInstance());r(this,"state",y.getInstance());this.view=t,this.sendAutoLoginRequest=this.sendAutoLoginRequest.bind(this),this.state.subscribe(u.OpenSocket,this.sendAutoLoginRequest)}render(t){t.prepend(this.view.getElement())}setContent(t){console.log("setting view",t),this.view.removeChildrenComponents(),this.view.addChildrenComponents("end",t)}sendAutoLoginRequest(){const t=sessionStorage.getItem(C.User);if(t){const s=JSON.parse(t);R(s)?(console.log("sending AUTO login request"),this.socket.sendLoginRequest(s.login,s.password)):this.setContent(new U)}else this.setContent(new U)}}const Ee="_app_vz7fw_2",be={app:Ee};class Me extends d{constructor(){super({tagName:"div",className:be.app})}}const Ue="modulepreload",_e=function(e,t){return new URL(e,t).href},N={},_=function(t,s,n){let i=Promise.resolve();if(s&&s.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),p=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.all(s.map(c=>{if(c=_e(c,n),c in N)return;N[c]=!0;const f=c.endsWith(".css"),B=f?'[rel="stylesheet"]':"";if(!!n)for(let g=o.length-1;g>=0;g--){const L=o[g];if(L.href===c&&(!f||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${B}`))return;const h=document.createElement("link");if(h.rel=f?"stylesheet":Ue,f||(h.as="script",h.crossOrigin=""),h.href=c,p&&h.setAttribute("nonce",p),document.head.appendChild(h),f)return new Promise((g,L)=>{h.addEventListener("load",g),h.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${c}`)))})}))}return i.then(()=>t()).catch(o=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o})};class V{constructor(t,s){r(this,"routes");r(this,"app");r(this,"state",y.getInstance());r(this,"showRelevantPage",async()=>{const t=this.state.getValue(u.CurrentUser);if(R(t)){console.log("moving to chat page");const{default:s}=await _(()=>import("./ChatPageView-Baj8eUMg.js"),__vite__mapDeps([0,1]),import.meta.url);this.app.setContent(new s)}else{const{default:s}=await _(()=>Promise.resolve().then(()=>T),void 0,import.meta.url);this.app.setContent(new s)}});this.routes=t,this.app=s,this.state.subscribe(u.CurrentUser,this.showRelevantPage)}async init(){window.addEventListener("hashchange",async()=>{await this.showCurrentHashRoute()}),document.addEventListener("click",async t=>{const{target:s}=t;if(s instanceof HTMLElement&&s.dataset.navigate){let n=s.dataset.navigate;window.location.hash=n,n.startsWith("#")&&(n=n.slice(1)),await this.showRoute(n)}})}async showCurrentHashRoute(){const t=V.getCurrentPath();await this.showRoute(t)}async showRoute(t){const s=this.routes.find(n=>n.path===t);if(s){const n=await s.callback();n&&this.app.setContent(n)}}static getCurrentPath(){let t=document.location.hash;return t.length&&(t=t.slice(1)),t}}const Se=[{path:k.Login,callback:async()=>{try{const{default:e}=await _(()=>Promise.resolve().then(()=>T),void 0,import.meta.url);return new e}catch(e){return console.log("Error loading module",e),null}}}],$=new we(new Me);$.render(document.body);const Ie=new V(Se,$);Ie.init();setTimeout(async()=>{alert("привет! еще доделываю функционал, пожалуйста, по возможности проверь ближе к концу кросс-чека")},0);export{d as B,b as C,S as E,x as I,y as S,v as W,ye as a,u as b,Pe as c,Oe as d,q as e,ne as f,R as i,xe as m,le as p};
