var y=Object.defineProperty;var I=(a,t,e)=>t in a?y(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var n=(a,t,e)=>(I(a,typeof t!="symbol"?t+"":t,e),e);import{B as c,a as V,S as p,W as _,E as b,b as i,i as L,I as H,d as C,C as l,c as E,p as h,e as f,f as M,m as N}from"./index-DgLMW9Bg.js";const S="_page_ghghs_1",k="_main_ghghs_8",$="_appName_ghghs_20",v={page:S,main:k,appName:$},A="_header_1kblf_1",F={header:A};class T extends c{constructor(...t){super({tagName:"header",className:F.header},...t)}}class B extends V{constructor(){super({type:"button",textContent:"Logout"});n(this,"state",p.getInstance());n(this,"socket",_.getInstance());this.initListeners()}initListeners(){this.element.addEventListener(b.Click,()=>{const e=this.state.getValue(i.CurrentUser);console.log(this.state),e&&L(e)&&this.socket.sendLogoutRequest(e.login,e.password)})}}const R="_list_twoah_1",q="_user_twoah_10",P="_online_twoah_32",O="_offline_twoah_35",W="_hidden_twoah_39",o={list:R,user:q,online:P,offline:O,hidden:W};class D extends c{constructor(){super({tagName:"div",className:o.list});n(this,"socket",_.getInstance());n(this,"state",p.getInstance());n(this,"activeUsersContainer");n(this,"inactiveUsersContainer");n(this,"searchInput");n(this,"updateActiveUsersList",()=>{const e=this.state.getValue(i.ActiveUsers),s=this.state.getValue(i.CurrentUser),r=L(s)?s.login:null;if(E(e)){const d=e.reduce((w,x)=>(x.login!==r&&w.push(h(x.login,`${o.user} ${o.online}`)),w),[]);this.activeUsersContainer.removeChildrenComponents(),this.activeUsersContainer.addChildrenComponents("end",...d)}});n(this,"updateInActiveUsersList",()=>{const e=this.state.getValue(i.InactiveUsers);if(E(e)){const s=e.map(r=>h(r.login,`${o.user} ${o.offline}`));this.inactiveUsersContainer.removeChildrenComponents(),this.inactiveUsersContainer.addChildrenComponents("end",...s)}});n(this,"handleExternalLogin",()=>{const e=this.state.getValue(i.ExternalLogin);typeof e=="string"&&(this.inactiveUsersContainer.removeChildComponent(e),this.activeUsersContainer.addChildrenComponents("begin",h(e,`${o.user} ${o.online}`)))});n(this,"handleExternalLogout",()=>{const e=this.state.getValue(i.ExternalLogout);typeof e=="string"&&(this.activeUsersContainer.removeChildComponent(e),this.inactiveUsersContainer.addChildrenComponents("begin",h(e,`${o.user} ${o.offline}`)))});this.searchInput=new H({type:"search"}),this.activeUsersContainer=C(),this.inactiveUsersContainer=C(),this.addChildrenComponents("end",this.searchInput,this.activeUsersContainer,this.inactiveUsersContainer),this.socket.sendActiveUsersRequest(),this.socket.sendInActiveUsersRequest(),this.state.subscribe(i.ActiveUsers,this.updateActiveUsersList),this.state.subscribe(i.InactiveUsers,this.updateInActiveUsersList),this.state.subscribe(i.ExternalLogin,this.handleExternalLogin),this.state.subscribe(i.ExternalLogout,this.handleExternalLogout),this.initEventListeners()}initEventListeners(){this.initClickListener(),this.initSearchInputListener()}initClickListener(){this.element.addEventListener("click",({target:e})=>{e instanceof HTMLParagraphElement&&e.dispatchEvent(new CustomEvent(l.OpenChat,{bubbles:!0,detail:e.textContent}))})}initSearchInputListener(){this.element.addEventListener(l.FormInput,e=>{if(e instanceof CustomEvent){const s=e.detail;typeof s=="string"&&(this.activeUsersContainer.children.forEach(r=>{var d;(d=r.getTextContent())!=null&&d.startsWith(s)?r.removeClass(o.hidden):r.addClass(o.hidden)}),this.inactiveUsersContainer.children.forEach(r=>{var d;(d=r.getTextContent())!=null&&d.startsWith(s)?r.removeClass(o.hidden):r.addClass(o.hidden)}))}})}}const K="_chatHeader_1o64a_1",j="_messageHistory_1o64a_1",z="_chat_1o64a_1",G="_disclaimer_1o64a_25",g={chatHeader:K,messageHistory:j,chat:z,disclaimer:G},J="_message_1okwb_1",Q="_outgoing_1okwb_10",X="_incoming_1okwb_13",m={message:J,outgoing:Q,incoming:X};class u extends c{constructor(t,e){const{text:s}=t;super({tagName:"div",className:`${m.message} ${e}`,textContent:s})}}const Y="_form_1lmor_1",Z={form:Y},ee="_textarea_eabgv_1",se={textarea:ee};class te extends c{constructor(t){super({tagName:"textarea",className:se.textarea,...t}),this.initListeners()}getValue(){return this.element.value}setValue(t){this.element.value=t}focus(){this.element.focus()}disable(){this.element.disabled=!0}enable(){this.element.disabled=!1}setParameters(t){super.setParameters(t);const{required:e,disabled:s}=t;e&&(this.element.required=e),s&&(this.element.disabled=s)}initListeners(){this.element.addEventListener(b.Input,()=>{this.element.dispatchEvent(new CustomEvent(l.FormInput,{bubbles:!0,detail:this.getValue()}))})}}class ne extends c{constructor(){super({tagName:"form",className:Z.form,novalidate:!0});n(this,"messageTextArea");n(this,"sendButton");this.messageTextArea=new te({disabled:!0}),this.sendButton=new V({type:"submit",textContent:"Send",disabled:!0}),this.addChildrenComponents("end",this.messageTextArea,this.sendButton),this.initListeners()}enable(){this.messageTextArea.enable()}clear(){this.messageTextArea.setValue("")}setParameters(e){super.setParameters(e);const{novalidate:s}=e;s&&(this.element.noValidate=s)}initListeners(){this.initSubmitListener(),this.initFormInputListener()}initSubmitListener(){this.element.addEventListener(b.Submit,e=>{e.preventDefault();const s=this.messageTextArea.getValue();this.element.dispatchEvent(new CustomEvent(l.SendChatMessage,{bubbles:!0,detail:s}))})}initFormInputListener(){this.element.addEventListener(l.FormInput,()=>{console.log("event"),this.messageTextArea.getValue().length===0?this.sendButton.disable():this.sendButton.enable()})}}class U extends c{constructor(e){super({tagName:"div",className:g.chat});n(this,"socket",_.getInstance());n(this,"state",p.getInstance());n(this,"messageHistory");n(this,"messageForm");n(this,"username");n(this,"showSentMessage",()=>{const e=this.state.getValue(i.MessageSent);if(f(e)){const{to:s}=e;s===this.username&&this.messageHistory.addChildrenComponents("end",new u(e,m.outgoing))}this.messageForm.clear()});n(this,"showReceivedMessage",()=>{const e=this.state.getValue(i.MessageReceived);if(console.log("adding received message",f(e)),f(e)){const{from:s}=e;s===this.username&&this.messageHistory.addChildrenComponents("end",new u(e,m.incoming))}});n(this,"showMessageHistory",()=>{const e=this.state.getValue(i.MessageHistory);M(e)&&e.length&&(e[0].from===this.username||e[0].to===this.username)&&e.forEach(s=>{s.from===this.username?this.messageHistory.addChildrenComponents("end",new u(s,m.incoming)):this.messageHistory.addChildrenComponents("end",new u(s,m.outgoing))})});this.messageHistory=C(g.messageHistory),this.messageForm=new ne,this.addChildrenComponents("end",this.messageHistory,C("",this.messageForm)),e?(this.username=e,this.addChildrenComponents("begin",h(e,g.chatHeader)),this.state.subscribe(i.MessageSent,this.showSentMessage),this.state.subscribe(i.MessageReceived,this.showReceivedMessage),this.state.subscribe(i.MessageHistory,this.showMessageHistory),this.messageForm.enable(),this.socket.sendMessageHistoryRequest(e)):this.messageHistory.addChildrenComponents("end",h("Select a chat to start messaging.",g.disclaimer)),this.initListeners()}initListeners(){this.element.addEventListener(l.SendChatMessage,e=>{if(e instanceof CustomEvent){const s=e.detail;this.username&&typeof s=="string"&&this.socket.sendChatMessage(this.username,s)}})}}const ie="_footer_oykx8_1",ae={footer:ie};class oe extends c{constructor(...t){super({tagName:"footer",className:ae.footer},...t)}}class ce extends c{constructor(){super({tagName:"div",className:v.page});n(this,"state",p.getInstance());n(this,"chat");n(this,"main");const e=[h("Fun Chat",v.appName),new B],s=this.state.getValue(i.CurrentUser);L(s)&&e.unshift(h(s.login)),this.chat=new U,this.main=N(v.main,new D,this.chat),this.addChildrenComponents("end",new T(...e),this.main,new oe),this.initListeners()}initListeners(){this.initOpenChatListener()}initOpenChatListener(){this.element.addEventListener(l.OpenChat,e=>{if(e instanceof CustomEvent){const s=e.detail;typeof s=="string"&&(this.main.removeChildComponent(this.chat),this.chat=new U(s),this.main.addChildrenComponents("end",this.chat))}})}}export{ce as default};
