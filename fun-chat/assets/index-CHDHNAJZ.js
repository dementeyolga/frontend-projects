function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./ChatPageView-Ch5-SHWb.js","./InputView-SSld5dbV.js","./InputView-B7YEhyxn.css","./ChatPageView-CgNGMciD.css","./LoginPageView-CONA5Hk5.js","./LoginPageView-eL5LWlws.css","./AboutPageView-LtLEMUFO.js","./AboutPageView-a3a1MWJ4.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var q=Object.defineProperty;var T=(e,t,s)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var o=(e,t,s)=>(T(e,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();var R=(e=>(e.Login="",e.About="about",e))(R||{}),E=(e=>(e.User="funChatAppAuthenticatedUser",e))(E||{}),a=(e=>(e.OpenSocket="openSocket",e.Login="login",e.CurrentUser="currentUser",e.ActiveUsers="activeUsers",e.InactiveUsers="inactiveUsers",e.ExternalLogin="externalLogin",e.ExternalLogout="externalLogout",e.MessageSent="messageSent",e.MessageReceived="messageReceived",e.MessageHistory="messageHistory",e.MessageDelivered="messageDelivered",e.MessageRead="messageRead",e.MessageDeleted="messageDeleted",e.MessageEdited="messageEdited",e.LoginError="loginError",e.ResetUnreadMessages="resetUnreadMessages",e))(a||{}),r=(e=>(e.UserLogin="USER_LOGIN",e.UserLogout="USER_LOGOUT",e.UserExternalLogin="USER_EXTERNAL_LOGIN",e.UserExternalLogout="USER_EXTERNAL_LOGOUT",e.UsersActive="USER_ACTIVE",e.UsersInactive="USER_INACTIVE",e.SendMessage="MSG_SEND",e.MessageHistory="MSG_FROM_USER",e.MessageDelivered="MSG_DELIVER",e.MessageRead="MSG_READ",e.DeleteMessage="MSG_DELETE",e.EditMessage="MSG_EDIT",e.Error="ERROR",e))(r||{}),B=(e=>(e.Input="input",e.Change="change",e.Submit="submit",e.Click="click",e.Scroll="scroll",e.Keydown="keydown",e))(B||{}),O=(e=>(e.FormInput="form-input",e.FormChange="form-change",e.TextAreaInput="textarea-input",e.OpenChat="open-chat",e.SendChatMessage="send-chat-message",e.EditMessage="edit-message",e.RemoveErrorModal="remove-error-modal",e))(O||{}),L=(e=>(e.Open="open",e.Close="close",e.Message="message",e.Error="error",e))(L||{}),_=(e=>(e.UserAlreadyAuthorized="a user with this login is already authorized",e.IncorrectPassword="incorrect password",e.LogoutWrongCredentials="there is no user with this login",e.LogoutUserNotAuthorized="the user was not authorized",e.SenderAndRecipientLoginsSame="sender and recipient logins are the same",e.MessageOperationWrongRecipientLogin="the user with the specified login does not exist",e.MessageOperationUserNotLogined="user not registered or not logged",e.WrongMessageID="incorrect message id",e.MessageOperationUserNotRecipient="user not recipient cannot be executed",e.IncorrectRequestStructure="incorrect request structure",e.IncorrectTypeParameters="incorrect type parameters",e.RequestPayloadNotSupported="incorrect payload parameters",e.InternalServerError="internal server error",e))(_||{});function I(e){return e instanceof Object&&typeof e.login=="string"&&typeof e.isLogined=="boolean"}function A(e){return e instanceof Object&&typeof e.login=="string"&&typeof e.password=="string"}function Ne(e){return!!(Array.isArray(e)&&(e.length===0||e.every(I)))}function v(e){return!!(e.user&&I(e.user))}function H(e){return!!(e.user&&A(e.user))}function j(e){if(typeof e.id=="string"&&e.type===r.UserLogin&&e.payload){const{payload:t}=e;if(H(t))return!0}return!1}function W(e){if(typeof e.id=="string"&&e.type===r.UserLogin&&e.payload){const{payload:t}=e;if(v(t))return!0}return!1}function $(e){if(e.type===r.UserLogout&&e.payload){const{payload:t}=e;if(v(t))return!0}return!1}function x(e){return!!(e.users&&(!e.users.length||e.users.every(I)))}function G(e){if(e.type===r.UsersActive&&e.payload){const{payload:t}=e;if(x(t))return!0}return!1}function z(e){return!!(e.type===r.UsersInactive&&e.payload&&x(e.payload))}function F(e){return!!(e&&typeof e.error=="string")}function J(e){return!!(e.type===r.Error&&e.payload&&F(e.payload))}function X(e){return!!(e.type===r.UserExternalLogin&&v(e.payload))}function Q(e){return!!(e.type===r.UserExternalLogout&&v(e.payload))}function Y(e){return e instanceof Object&&typeof e.text=="string"&&typeof e.to=="string"}function Z(e){return e instanceof Object&&typeof e.isDelivered=="boolean"&&typeof e.isEdited=="boolean"&&typeof e.isReaded=="boolean"}function S(e){return!!(Y(e)&&typeof e.from=="string"&&typeof e.datetime=="number"&&typeof e.id=="string"&&Z(e.status))}function K(e){return!!(e instanceof Object&&e.message&&S(e.message))}function ee(e){return!!(e instanceof Object&&e.type===r.SendMessage&&K(e.payload))}function te(e){return!!(Array.isArray(e)&&(e.length===0||e.every(S)))}function se(e){const{messages:t}=e;return!!(e instanceof Object&&t&&te(t))}function ne(e){return!!(e instanceof Object&&e.type===r.MessageHistory&&se(e.payload))}function ie(e){return!!(e instanceof Object&&e.message&&e.message.id&&typeof e.message.id=="string"&&e.message.status&&typeof e.message.status.isDelivered=="boolean")}function re(e){return!!(e instanceof Object&&e.type===r.MessageDelivered&&ie(e.payload))}function oe(e){return!!(e instanceof Object&&e.message&&typeof e.message.id=="string"&&e.message.status&&typeof e.message.status.isReaded=="boolean")}function ae(e){return!!(e instanceof Object&&e.type===r.MessageRead&&oe(e.payload))}function le(e){return!!(e instanceof Object&&e.message&&typeof e.message.id=="string"&&e.message.status&&typeof e.message.status.isDeleted=="boolean")}function ue(e){return!!(e instanceof Object&&e.type===r.DeleteMessage&&le(e.payload))}function ce(e){return!!(e instanceof Object&&e.message&&typeof e.message.id=="string"&&typeof e.message.text=="string"&&e.message.status&&typeof e.message.status.isEdited=="boolean")}function de(e){return!!(e instanceof Object&&e.type===r.EditMessage&&ce(e.payload))}const C=class C{constructor(){o(this,"observedValues",new Map);o(this,"notifyCallbacks",new Map)}static getInstance(){return this.instance}getValue(t){return this.observedValues.has(t)?this.observedValues.get(t):null}setValue(t,s){this.observedValues.set(t,s),this.notify(t,s)}triggerEvent(t){console.log(`event ${t} triggered`),this.notify(t)}subscribe(t,s){console.log(`SUBSCIBED TO EVENT ${t}`);let n=this.notifyCallbacks.get(t);n||(n=new Set,this.notifyCallbacks.set(t,n)),n.add(s)}unsubscribe(t,s){const n=this.notifyCallbacks.get(t);n&&n.delete(s)}notify(t,s){const n=this.notifyCallbacks.get(t);console.log(`notifying about ${t} event`,n),n&&n.forEach(i=>i(s))}};o(C,"instance",new C);let g=C;const w=class w{constructor(t){o(this,"socket");o(this,"state",g.getInstance());o(this,"requests",[]);this.url=t,this.socket=new WebSocket(`ws://${t}`),this.initSocketListeners()}static getInstance(){return this.instance}openSocketConnection(t){this.socket=new WebSocket(`ws://${t}`),this.initSocketListeners()}initSocketListeners(){this.initOpenListener()}initOpenListener(){this.socket.addEventListener(L.Open,()=>{console.log("socket has opened"),this.initMessageListener(),this.initErrorListener(),this.initCloseListener(),this.state.setValue(a.OpenSocket,"open")})}initCloseListener(){this.socket.addEventListener(L.Close,()=>{console.log("socket has closed"),this.openSocketConnection(this.url),this.initOpenListener()})}initErrorListener(){this.socket.addEventListener(L.Error,t=>{console.log("WebSocket error: ",t)})}initMessageListener(){this.socket.addEventListener(L.Message,t=>{const s=JSON.parse(t.data);if(W(s)){console.log("user logined: ",s);const n=this.requests.find(i=>i.id===s.id&&i.type===r.UserLogin);if(n&&j(n)){const{user:i}=n.payload;sessionStorage.setItem(E.User,JSON.stringify(i)),this.state.setValue(a.CurrentUser,i)}}if($(s)&&(sessionStorage.removeItem(E.User),this.state.setValue(a.CurrentUser,null)),G(s)&&(console.log("active users response",s),this.state.setValue(a.ActiveUsers,s.payload.users)),z(s)&&(console.log("inactive users response",s),this.state.setValue(a.InactiveUsers,s.payload.users)),X(s)&&(console.log("user logged in",s.payload.user),this.state.setValue(a.ExternalLogin,s.payload.user.login)),Q(s)&&(console.log("user logged out",s.payload.user),this.state.setValue(a.ExternalLogout,s.payload.user.login)),ee(s)&&(s.id===null?(console.log("message received",s),this.state.setValue(a.MessageReceived,s.payload.message)):(console.log("message successfully sent",s),this.state.setValue(a.MessageSent,s.payload.message))),ne(s)&&(console.log("message history received",s),this.state.setValue(a.MessageHistory,s.payload.messages)),re(s)&&(console.log("message status changed to DELIVERED",s),this.state.setValue(a.MessageDelivered,s.payload)),ae(s)&&(console.log("message was READ",s),this.state.setValue(a.MessageRead,s.payload)),ue(s)&&(console.log("need to DELETE a message",s),this.state.setValue(a.MessageDeleted,s.payload)),de(s)&&(console.log("need to EDIT a message",s),this.state.setValue(a.MessageEdited,s.payload)),J(s)){console.log("error",s.payload);const{error:n}=s.payload;(n===_.UserAlreadyAuthorized||n===_.IncorrectPassword)&&this.state.setValue(a.LoginError,n)}})}sendLoginRequest(t,s){const n={id:String(this.requests.length+1),type:r.UserLogin,payload:{user:{login:t,password:s}}};this.requests.push(n),this.send(n)}sendLogoutRequest(t,s){const n={id:String(this.requests.length+1),type:r.UserLogout,payload:{user:{login:t,password:s}}};this.requests.push(n),this.send(n)}sendActiveUsersRequest(){const t={id:String(this.requests.length+1),type:r.UsersActive,payload:null};this.requests.push(t),this.send(t)}sendInActiveUsersRequest(){const t={id:String(this.requests.length+1),type:r.UsersInactive,payload:null};this.requests.push(t),this.send(t)}sendChatMessage(t,s){const n={id:String(this.requests.length+1),type:r.SendMessage,payload:{message:{to:t,text:s}}};this.requests.push(n),this.send(n)}sendMessageHistoryRequest(t){const s={id:String(this.requests.length+1),type:r.MessageHistory,payload:{user:{login:t}}};this.requests.push(s),this.send(s)}sendReadMessageRequest(t){const s={id:String(this.requests.length+1),type:r.MessageRead,payload:{message:{id:t}}};this.requests.push(s),this.send(s)}sendDeleleMessageRequest(t){const s={id:String(this.requests.length+1),type:r.DeleteMessage,payload:{message:{id:t}}};this.requests.push(s),this.send(s)}sendEditMessageRequest(t,s){const n={id:String(this.requests.length+1),type:r.EditMessage,payload:{message:{id:t,text:s}}};this.requests.push(n),this.send(n)}send(t){const s=JSON.stringify(t);this.socket.send(s)}};o(w,"instance",new w("127.0.0.1:4000"));let U=w;class he{constructor(t){o(this,"socket",U.getInstance());o(this,"state",g.getInstance());o(this,"sendAutoLoginRequest",()=>{const t=sessionStorage.getItem(E.User);if(t){const s=JSON.parse(t);A(s)&&(console.log("sending AUTO login request"),this.socket.sendLoginRequest(s.login,s.password))}});this.view=t,this.state.subscribe(a.OpenSocket,this.sendAutoLoginRequest)}render(t){t.prepend(this.view.getElement())}setContent(t){console.log("setting view",t),this.view.removeChildrenComponents(),this.view.addChildrenComponents("end",t)}}function M(e){return Array.from(e.childNodes).reduce((n,i)=>n+(i.nodeType===3?i.textContent:""),"")}class d{constructor(t,...s){o(this,"children",[]);o(this,"element");o(this,"id");const n=document.createElement(t.tagName||"div");this.element=n,this.setParameters(t),s.length&&this.addChildrenComponents("end",...s)}getElement(){return this.element}getElementWidth(){return this.element.offsetWidth}setTextContent(t){this.element.textContent=t}setInnerHTML(t){this.element.innerHTML=t}getTextContent(){return M(this.element)}setParameters(t){const{textContent:s,className:n,id:i,innerHTML:l}=t;s&&(this.element.textContent=s),n&&this.setClassName(n),i&&(this.element.id=i),l&&(this.element.innerHTML=l)}addChildrenComponents(t,...s){s.forEach(async n=>{this.addChild(n.getElement(),t),t==="end"?this.children.push(n):this.children.unshift(n)})}removeChildrenComponents(){this.children.length=0;const t=this.getElement();t.innerHTML=""}removeChildComponent(t){let s;if(t instanceof d?s=t:typeof t=="number"?s=this.findChildComponentById(t):t instanceof HTMLElement?s=this.findChildComponentByElement(t):typeof t=="string"&&(s=this.findChildComponentByTextContent(t)),s){const n=this.children.indexOf(s);this.children.splice(n,1),s.destroy(),console.log("deleting component",s)}}destroy(){this.element.remove()}findChildComponentByElement(t){return this.children.find(n=>n.getElement()===t)}findChildComponentById(t){return this.children.find(n=>n.id?n.id===t:!1)}findChildComponentByTextContent(t){return this.children.find(n=>M(n.element)?M(n.element)===t:!1)}setClassName(t){this.element.className=t}addClass(t){this.element.classList.add(t)}removeClass(t){this.element.classList.remove(t)}addChild(t,s){s==="begin"?this.element.prepend(t):this.element.append(t)}}const fe="_app_vz7fw_2",ge={app:fe},pe="_modalWrapper_r8pp9_1",me="_invisible_r8pp9_18",ye="_visible_r8pp9_22",Le="_fadeIn_r8pp9_1",Ee="_modal_r8pp9_1",be="_closeButton_r8pp9_41",y={modalWrapper:pe,invisible:me,visible:ye,fadeIn:Le,modal:Ee,closeButton:be},ke=(e,t)=>new d({tagName:"h2",className:t,textContent:e}),Ce=(e,...t)=>new d({tagName:"div",className:e},...t),qe=(e,...t)=>new d({tagName:"main",className:e},...t),we=(e,t)=>new d({tagName:"p",className:t,textContent:e}),ve="_button_h8uif_1",Me="_primary_h8uif_18",Re="_secondary_h8uif_35",_e={button:ve,primary:Me,secondary:Re};class Ue extends d{constructor(t,s){super({tagName:"button",className:_e.button,...t}),s&&(this.element.dataset.navigate=s)}setParameters(t){super.setParameters(t);const{type:s,disabled:n}=t;s&&(this.element.type=s),n&&(this.element.disabled=n)}disable(){this.element.disabled=!0}enable(){this.element.disabled=!1}}class Oe extends d{constructor(s){super({tagName:"div",className:y.modalWrapper});o(this,"closeButton");this.closeButton=new Ue({textContent:"✖",type:"button",className:y.closeButton}),this.addChildrenComponents("end",Ce(y.modal,we(s),this.closeButton)),setTimeout(()=>{this.addClass(y.visible)},0),this.initClickListener()}initClickListener(){this.element.onclick=({target:s})=>{(s===this.element||s===this.closeButton.getElement())&&this.element.dispatchEvent(new CustomEvent(O.RemoveErrorModal,{bubbles:!0}))}}destroy(){this.addClass(y.invisible),this.element.ontransitionend=()=>super.destroy()}}class Ie extends d{constructor(){super({tagName:"div",className:ge.app});o(this,"state",g.getInstance());o(this,"errorModal",null);o(this,"showErrorModal",()=>{const s=this.state.getValue(a.LoginError);typeof s=="string"&&(this.errorModal=new Oe(s),this.addChildrenComponents("end",this.errorModal))});this.state.subscribe(a.LoginError,this.showErrorModal),this.initListeners()}destroy(){super.destroy(),this.state.unsubscribe(a.LoginError,this.showErrorModal)}initListeners(){this.element.addEventListener(O.RemoveErrorModal,()=>{this.errorModal&&(this.removeChildComponent(this.errorModal),this.errorModal=null)})}}const Ae="modulepreload",Ve=function(e,t){return new URL(e,t).href},D={},f=function(t,s,n){let i=Promise.resolve();if(s&&s.length>0){const l=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),P=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=Promise.all(s.map(c=>{if(c=Ve(c,n),c in D)return;D[c]=!0;const p=c.endsWith(".css"),k=p?'[rel="stylesheet"]':"";if(!!n)for(let m=l.length-1;m>=0;m--){const b=l[m];if(b.href===c&&(!p||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${k}`))return;const h=document.createElement("link");if(h.rel=p?"stylesheet":Ae,p||(h.as="script",h.crossOrigin=""),h.href=c,P&&h.setAttribute("nonce",P),document.head.appendChild(h),p)return new Promise((m,b)=>{h.addEventListener("load",m),h.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${c}`)))})}))}return i.then(()=>t()).catch(l=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l})};class V{constructor(t,s){o(this,"routes");o(this,"app");o(this,"state",g.getInstance());o(this,"showRelevantPage",async()=>{if(window.location.hash===""){const t=this.state.getValue(a.CurrentUser);if(A(t)){const{default:s}=await f(()=>import("./ChatPageView-Ch5-SHWb.js"),__vite__mapDeps([0,1,2,3]),import.meta.url);this.app.setContent(new s)}else{const{default:s}=await f(()=>import("./LoginPageView-CONA5Hk5.js"),__vite__mapDeps([4,1,2,5]),import.meta.url);this.app.setContent(new s)}}else{const{default:t}=await f(()=>import("./AboutPageView-LtLEMUFO.js"),__vite__mapDeps([6,7]),import.meta.url);this.app.setContent(new t)}});this.routes=t,this.app=s,this.state.subscribe(a.CurrentUser,this.showRelevantPage),this.showCurrentHashRoute()}async init(){window.addEventListener("hashchange",async()=>{await this.showCurrentHashRoute()}),document.addEventListener("click",async t=>{const{target:s}=t;if(s instanceof HTMLElement&&s.dataset.navigate){let n=s.dataset.navigate;window.location.hash=n,n.startsWith("#")&&(n=n.slice(1)),await this.showRoute(n)}})}async showCurrentHashRoute(){const t=V.getCurrentPath();await this.showRoute(t)}async showRoute(t){const s=this.routes.find(n=>n.path===t);if(s){const n=await s.callback();n&&this.app.setContent(n)}}static getCurrentPath(){let t=window.location.hash;return t.length&&(t=t.slice(1)),t}}const Pe=[{path:R.Login,callback:async()=>{try{const e=sessionStorage.getItem(E.User);let t=null;return e?{default:t}=await f(()=>import("./ChatPageView-Ch5-SHWb.js"),__vite__mapDeps([0,1,2,3]),import.meta.url):{default:t}=await f(()=>import("./LoginPageView-CONA5Hk5.js"),__vite__mapDeps([4,1,2,5]),import.meta.url),new t}catch(e){return console.log("Error loading module",e),null}}},{path:R.About,callback:async()=>{try{const{default:e}=await f(()=>import("./AboutPageView-LtLEMUFO.js"),__vite__mapDeps([6,7]),import.meta.url);return new e}catch(e){return console.log("Error loading module",e),null}}}],N=new he(new Ie);N.render(document.body);const De=new V(Pe,N);De.init();export{d as B,O as C,B as E,g as S,U as W,Ue as a,a as b,te as c,S as d,Ce as e,Ne as f,M as g,ie as h,A as i,oe as j,ce as k,le as l,qe as m,ke as n,we as p};
