function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./ChatPageView-BDEqeh3l.js","./ButtonView-Cdq7Z-Gm.js","./ButtonView-CTkfvHBo.css","./InputView-T_GTZj1F.js","./InputView-B7YEhyxn.css","./ChatPageView-Cor8w7qa.css","./LoginPageView-XKJNyxjD.js","./LoginPageView-eL5LWlws.css","./AboutPageView-qlNo5CYn.js","./AboutPageView-a3a1MWJ4.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var P=Object.defineProperty;var x=(e,t,s)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var a=(e,t,s)=>(x(e,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();var M=(e=>(e.Login="",e.About="about",e))(M||{}),m=(e=>(e.User="funChatAppAuthenticatedUser",e))(m||{}),l=(e=>(e.OpenSocket="openSocket",e.Login="login",e.CurrentUser="currentUser",e.ActiveUsers="activeUsers",e.InactiveUsers="inactiveUsers",e.ExternalLogin="externalLogin",e.ExternalLogout="externalLogout",e.MessageSent="messageSent",e.MessageReceived="messageReceived",e.MessageHistory="messageHistory",e.MessageDelivered="messageDelivered",e.MessageRead="messageRead",e.MessageDeleted="messageDeleted",e.MessageEdited="messageEdited",e))(l||{}),r=(e=>(e.UserLogin="USER_LOGIN",e.UserLogout="USER_LOGOUT",e.UserExternalLogin="USER_EXTERNAL_LOGIN",e.UserExternalLogout="USER_EXTERNAL_LOGOUT",e.UsersActive="USER_ACTIVE",e.UsersInactive="USER_INACTIVE",e.SendMessage="MSG_SEND",e.MessageHistory="MSG_FROM_USER",e.MessageDelivered="MSG_DELIVER",e.MessageRead="MSG_READ",e.DeleteMessage="MSG_DELETE",e.EditMessage="MSG_EDIT",e.Error="ERROR",e))(r||{}),k=(e=>(e.Input="input",e.Change="change",e.Submit="submit",e.Click="click",e.Scroll="scroll",e))(k||{}),q=(e=>(e.FormInput="form-input",e.FormChange="form-change",e.TextAreaInput="textarea-input",e.OpenChat="open-chat",e.SendChatMessage="send-chat-message",e.EditMessage="edit-message",e))(q||{}),p=(e=>(e.Open="open",e.Close="close",e.Message="message",e.Error="error",e))(p||{});function w(e){return e instanceof Object&&typeof e.login=="string"&&typeof e.isLogined=="boolean"}function R(e){return e instanceof Object&&typeof e.login=="string"&&typeof e.password=="string"}function Le(e){return!!(Array.isArray(e)&&(e.length===0||e.every(w)))}function v(e){return!!(e.user&&w(e.user))}function T(e){return!!(e.user&&R(e.user))}function N(e){if(typeof e.id=="string"&&e.type===r.UserLogin&&e.payload){const{payload:t}=e;if(T(t))return!0}return!1}function H(e){if(typeof e.id=="string"&&e.type===r.UserLogin&&e.payload){const{payload:t}=e;if(v(t))return!0}return!1}function j(e){if(e.type===r.UserLogout&&e.payload){const{payload:t}=e;if(v(t))return!0}return!1}function I(e){return!!(e.users&&(!e.users.length||e.users.every(w)))}function B(e){if(e.type===r.UsersActive&&e.payload){const{payload:t}=e;if(I(t))return!0}return!1}function G(e){return!!(e.type===r.UsersInactive&&e.payload&&I(e.payload))}function $(e){return!!(e&&typeof e.error=="string")}function W(e){return!!(e.type===r.Error&&e.payload&&$(e.payload))}function F(e){return!!(e.type===r.UserExternalLogin&&v(e.payload))}function J(e){return!!(e.type===r.UserExternalLogout&&v(e.payload))}function X(e){return e instanceof Object&&typeof e.text=="string"&&typeof e.to=="string"}function z(e){return e instanceof Object&&typeof e.isDelivered=="boolean"&&typeof e.isEdited=="boolean"&&typeof e.isReaded=="boolean"}function A(e){return!!(X(e)&&typeof e.from=="string"&&typeof e.datetime=="number"&&typeof e.id=="string"&&z(e.status))}function Q(e){return!!(e instanceof Object&&e.message&&A(e.message))}function Y(e){return!!(e instanceof Object&&e.type===r.SendMessage&&Q(e.payload))}function Z(e){return!!(Array.isArray(e)&&(e.length===0||e.every(A)))}function K(e){const{messages:t}=e;return!!(e instanceof Object&&t&&Z(t))}function ee(e){return!!(e instanceof Object&&e.type===r.MessageHistory&&K(e.payload))}function te(e){return!!(e instanceof Object&&e.message&&e.message.id&&typeof e.message.id=="string"&&e.message.status&&typeof e.message.status.isDelivered=="boolean")}function se(e){return!!(e instanceof Object&&e.type===r.MessageDelivered&&te(e.payload))}function ne(e){return!!(e instanceof Object&&e.message&&typeof e.message.id=="string"&&e.message.status&&typeof e.message.status.isReaded=="boolean")}function ie(e){return!!(e instanceof Object&&e.type===r.MessageRead&&ne(e.payload))}function re(e){return!!(e instanceof Object&&e.message&&typeof e.message.id=="string"&&e.message.status&&typeof e.message.status.isDeleted=="boolean")}function oe(e){return!!(e instanceof Object&&e.type===r.DeleteMessage&&re(e.payload))}function ae(e){return!!(e instanceof Object&&e.message&&typeof e.message.id=="string"&&typeof e.message.text=="string"&&e.message.status&&typeof e.message.status.isEdited=="boolean")}function le(e){return!!(e instanceof Object&&e.type===r.EditMessage&&ae(e.payload))}const L=class L{constructor(){a(this,"observedValues",new Map);a(this,"notifyCallbacks",new Map)}static getInstance(){return this.instance}getValue(t){return this.observedValues.has(t)?this.observedValues.get(t):null}setValue(t,s){this.observedValues.set(t,s),this.notify(t,s)}triggerEvent(t){console.log(`event ${t} triggered`),this.notify(t)}subscribe(t,s){console.log(`SUBSCIBED TO EVENT ${t}`);let n=this.notifyCallbacks.get(t);n||(n=new Set,this.notifyCallbacks.set(t,n)),n.add(s)}unsubscribe(t,s){const n=this.notifyCallbacks.get(t);n&&n.delete(s)}notify(t,s){const n=this.notifyCallbacks.get(t);console.log(`notifying about ${t} event`,n),n&&n.forEach(i=>i(s))}};a(L,"instance",new L);let y=L;const C=class C{constructor(t){a(this,"socket");a(this,"state",y.getInstance());a(this,"requests",[]);this.url=t,this.socket=new WebSocket(`ws://${t}`),this.initSocketListeners()}static getInstance(){return this.instance}openSocketConnection(t){this.socket=new WebSocket(`ws://${t}`),this.initSocketListeners()}initSocketListeners(){this.initOpenListener()}initOpenListener(){this.socket.addEventListener(p.Open,()=>{console.log("socket has opened"),this.initMessageListener(),this.initErrorListener(),this.initCloseListener(),this.state.setValue(l.OpenSocket,"open")})}initCloseListener(){this.socket.addEventListener(p.Close,()=>{console.log("socket has closed"),this.openSocketConnection(this.url),this.initOpenListener()})}initErrorListener(){this.socket.addEventListener(p.Error,t=>{console.log("WebSocket error: ",t)})}initMessageListener(){this.socket.addEventListener(p.Message,t=>{const s=JSON.parse(t.data);if(H(s)){console.log("user logined: ",s);const n=this.requests.find(i=>i.id===s.id&&i.type===r.UserLogin);if(n&&N(n)){console.log("relevant login request: ",n);const{user:i}=n.payload;sessionStorage.setItem(m.User,JSON.stringify(i)),this.state.setValue(l.CurrentUser,i)}}j(s)&&(sessionStorage.removeItem(m.User),this.state.setValue(l.CurrentUser,null)),B(s)&&(console.log("active users response",s),this.state.setValue(l.ActiveUsers,s.payload.users)),G(s)&&(console.log("inactive users response",s),this.state.setValue(l.InactiveUsers,s.payload.users)),W(s)&&console.log("error",s.payload),F(s)&&(console.log("user logged in",s.payload.user),this.state.setValue(l.ExternalLogin,s.payload.user.login)),J(s)&&(console.log("user logged out",s.payload.user),this.state.setValue(l.ExternalLogout,s.payload.user.login)),Y(s)&&(s.id===null?(console.log("message received",s),this.state.setValue(l.MessageReceived,s.payload.message)):(console.log("message successfully sent",s),this.state.setValue(l.MessageSent,s.payload.message))),ee(s)&&(console.log("message history received",s),this.state.setValue(l.MessageHistory,s.payload.messages)),se(s)&&(console.log("message status changed to DELIVERED",s),this.state.setValue(l.MessageDelivered,s.payload)),ie(s)&&(console.log("message was READ",s),this.state.setValue(l.MessageRead,s.payload)),oe(s)&&(console.log("need to DELETE a message",s),this.state.setValue(l.MessageDeleted,s.payload)),le(s)&&(console.log("need to EDIT a message",s),this.state.setValue(l.MessageEdited,s.payload))})}sendLoginRequest(t,s){const n={id:String(this.requests.length+1),type:r.UserLogin,payload:{user:{login:t,password:s}}};this.requests.push(n),this.send(n)}sendLogoutRequest(t,s){const n={id:String(this.requests.length+1),type:r.UserLogout,payload:{user:{login:t,password:s}}};this.requests.push(n),this.send(n)}sendActiveUsersRequest(){const t={id:String(this.requests.length+1),type:r.UsersActive,payload:null};this.requests.push(t),this.send(t)}sendInActiveUsersRequest(){const t={id:String(this.requests.length+1),type:r.UsersInactive,payload:null};this.requests.push(t),this.send(t)}sendChatMessage(t,s){const n={id:String(this.requests.length+1),type:r.SendMessage,payload:{message:{to:t,text:s}}};this.requests.push(n),this.send(n)}sendMessageHistoryRequest(t){const s={id:String(this.requests.length+1),type:r.MessageHistory,payload:{user:{login:t}}};this.requests.push(s),this.send(s)}sendReadMessageRequest(t){const s={id:String(this.requests.length+1),type:r.MessageRead,payload:{message:{id:t}}};this.requests.push(s),this.send(s)}sendDeleleMessageRequest(t){const s={id:String(this.requests.length+1),type:r.DeleteMessage,payload:{message:{id:t}}};this.requests.push(s),this.send(s)}sendEditMessageRequest(t,s){const n={id:String(this.requests.length+1),type:r.EditMessage,payload:{message:{id:t,text:s}}};this.requests.push(n),this.send(n)}send(t){const s=JSON.stringify(t);this.socket.send(s)}};a(C,"instance",new C("127.0.0.1:4000"));let b=C;class ue{constructor(t){a(this,"socket",b.getInstance());a(this,"state",y.getInstance());a(this,"sendAutoLoginRequest",()=>{const t=sessionStorage.getItem(m.User);if(t){const s=JSON.parse(t);R(s)&&(console.log("sending AUTO login request"),this.socket.sendLoginRequest(s.login,s.password))}});this.view=t,this.state.subscribe(l.OpenSocket,this.sendAutoLoginRequest)}render(t){t.prepend(this.view.getElement())}setContent(t){console.log("setting view",t),this.view.removeChildrenComponents(),this.view.addChildrenComponents("end",t)}}class U{constructor(t,...s){a(this,"children",[]);a(this,"element");a(this,"id");const n=document.createElement(t.tagName||"div");this.element=n,this.setParameters(t),s.length&&this.addChildrenComponents("end",...s)}getElement(){return this.element}getElementWidth(){return this.element.offsetWidth}setTextContent(t){this.element.textContent=t}setInnerHTML(t){this.element.innerHTML=t}getTextContent(){return this.element.textContent}setParameters(t){const{textContent:s,className:n,id:i,innerHTML:o}=t;s&&(this.element.textContent=s),n&&this.setClassName(n),i&&(this.element.id=i),o&&(this.element.innerHTML=o)}addChildrenComponents(t,...s){s.forEach(async n=>{this.addChild(n.getElement(),t),t==="end"?this.children.push(n):this.children.unshift(n)})}removeChildrenComponents(){this.children.length=0;const t=this.getElement();t.innerHTML=""}removeChildComponent(t){let s;if(t instanceof U?s=t:typeof t=="number"?s=this.findChildComponentById(t):t instanceof HTMLElement?s=this.findChildComponentByElement(t):typeof t=="string"&&(s=this.findChildComponentByTextContent(t)),s){const n=this.children.indexOf(s);this.children.splice(n,1),s.destroy()}}destroy(){this.element.remove()}findChildComponentByElement(t){return this.children.find(n=>n.getElement()===t)}findChildComponentById(t){return this.children.find(n=>n.id?n.id===t:!1)}findChildComponentByTextContent(t){return this.children.find(n=>n.getTextContent()?n.getTextContent()===t:!1)}setClassName(t){this.element.className=t}addClass(t){this.element.classList.add(t)}removeClass(t){this.element.classList.remove(t)}addChild(t,s){s==="begin"?this.element.prepend(t):this.element.append(t)}}const ce="_app_vz7fw_2",de={app:ce};class fe extends U{constructor(){super({tagName:"div",className:de.app})}}const ge="modulepreload",he=function(e,t){return new URL(e,t).href},_={},f=function(t,s,n){let i=Promise.resolve();if(s&&s.length>0){const o=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),S=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=Promise.all(s.map(c=>{if(c=he(c,n),c in _)return;_[c]=!0;const g=c.endsWith(".css"),D=g?'[rel="stylesheet"]':"";if(!!n)for(let h=o.length-1;h>=0;h--){const E=o[h];if(E.href===c&&(!g||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${D}`))return;const d=document.createElement("link");if(d.rel=g?"stylesheet":ge,g||(d.as="script",d.crossOrigin=""),d.href=c,S&&d.setAttribute("nonce",S),document.head.appendChild(d),g)return new Promise((h,E)=>{d.addEventListener("load",h),d.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${c}`)))})}))}return i.then(()=>t()).catch(o=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=o,window.dispatchEvent(u),!u.defaultPrevented)throw o})};class O{constructor(t,s){a(this,"routes");a(this,"app");a(this,"state",y.getInstance());a(this,"showRelevantPage",async()=>{if(window.location.hash===""){const t=this.state.getValue(l.CurrentUser);if(R(t)){const{default:s}=await f(()=>import("./ChatPageView-BDEqeh3l.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);this.app.setContent(new s)}else{const{default:s}=await f(()=>import("./LoginPageView-XKJNyxjD.js"),__vite__mapDeps([6,1,2,3,4,7]),import.meta.url);this.app.setContent(new s)}}else{const{default:t}=await f(()=>import("./AboutPageView-qlNo5CYn.js"),__vite__mapDeps([8,1,2,9]),import.meta.url);this.app.setContent(new t)}});this.routes=t,this.app=s,this.state.subscribe(l.CurrentUser,this.showRelevantPage),this.showCurrentHashRoute()}async init(){window.addEventListener("hashchange",async()=>{await this.showCurrentHashRoute()}),document.addEventListener("click",async t=>{const{target:s}=t;if(s instanceof HTMLElement&&s.dataset.navigate){let n=s.dataset.navigate;window.location.hash=n,n.startsWith("#")&&(n=n.slice(1)),await this.showRoute(n)}})}async showCurrentHashRoute(){const t=O.getCurrentPath();await this.showRoute(t)}async showRoute(t){const s=this.routes.find(n=>n.path===t);if(s){const n=await s.callback();n&&this.app.setContent(n)}}static getCurrentPath(){let t=window.location.hash;return t.length&&(t=t.slice(1)),t}}const pe=[{path:M.Login,callback:async()=>{try{const e=sessionStorage.getItem(m.User);let t=null;return e?{default:t}=await f(()=>import("./ChatPageView-BDEqeh3l.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url):{default:t}=await f(()=>import("./LoginPageView-XKJNyxjD.js"),__vite__mapDeps([6,1,2,3,4,7]),import.meta.url),new t}catch(e){return console.log("Error loading module",e),null}}},{path:M.About,callback:async()=>{try{const{default:e}=await f(()=>import("./AboutPageView-qlNo5CYn.js"),__vite__mapDeps([8,1,2,9]),import.meta.url);return new e}catch(e){return console.log("Error loading module",e),null}}}],V=new ue(new fe);V.render(document.body);const me=new O(pe,V);me.init();setTimeout(()=>{alert("привет! еще доделываю функционал, пожалуйста, по возможности проверь ближе к концу кросс-чека")},0);export{U as B,q as C,k as E,y as S,b as W,l as a,Le as b,te as c,ne as d,ae as e,re as f,A as g,Z as h,R as i};
